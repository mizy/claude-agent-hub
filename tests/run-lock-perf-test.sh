#!/bin/bash
# é”æ€§èƒ½æµ‹è¯•å¿«é€Ÿè¿è¡Œè„šæœ¬

set -e

echo "======================================"
echo "   é”æ€§èƒ½æµ‹è¯•æ‰§è¡Œè„šæœ¬"
echo "======================================"
echo ""

# æ£€æŸ¥æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•
if [ ! -f "package.json" ]; then
  echo "âŒ é”™è¯¯: è¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæ­¤è„šæœ¬"
  exit 1
fi

# æ¸…ç†æ—§çš„ä¸´æ—¶æµ‹è¯•æ–‡ä»¶
echo "ğŸ§¹ æ¸…ç†ä¸´æ—¶æµ‹è¯•æ–‡ä»¶..."
rm -f /tmp/cah-lock-test-* 2>/dev/null || true
echo "âœ… æ¸…ç†å®Œæˆ"
echo ""

# è¿è¡Œé”æ€§èƒ½æµ‹è¯•
echo "ğŸš€ è¿è¡Œé”æ€§èƒ½æµ‹è¯•..."
echo ""
npm run test -- tests/lock-performance.test.ts

echo ""
echo "======================================"
echo "   æµ‹è¯•å®Œæˆ"
echo "======================================"
